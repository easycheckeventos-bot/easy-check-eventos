{% extends "base.html" %}
{% block content %}

<div class="card">
  <div class="topline">
    <h2>Protocolo</h2>
    <div class="chips">
      <a class="chip" href="/">Home</a>
      <a class="chip" href="/dashboard">Dashboard</a>
      <a class="chip" href="/admin">Admin</a>
    </div>
  </div>

  <form method="POST" class="search">
    <input class="input" name="nome" placeholder="Pesquisar nome..." value="{{ nome }}">
    <button class="btn" type="submit">Procurar</button>
  </form>

  {% if resultados %}
    <div class="table">
      <div class="row head">
        <div>ID</div>
        <div>Nome</div>
        <div>Mesa</div>
        <div>Acomp.</div>
        <div>Total</div>
        <div>Status</div>
        <div>Ação</div>
      </div>

      {% for c in resultados %}
      {% set total = 1 + (c[3] or 0) %}
      <div class="row">
        <div>#{{ c[0] }}</div>
        <div><a href="/scan/{{ c[0] }}" class="link">{{ c[1] }}</a></div>
        <div>{{ c[2] }}</div>
        <div>{{ c[3] }}</div>
        <div><b>{{ total }}</b></div>
        <div>
          {% if c[4] == "Sim" %}
            <span class="pill ok">Entrou</span>
          {% else %}
            <span class="pill no">Não entrou</span>
          {% endif %}
        </div>
        <div>
          {% if c[4] == "Sim" %}
            <a class="btn btn-ghost" href="/resetar/{{ c[0] }}">Resetar</a>
          {% else %}
            <a class="btn" href="/entrar/{{ c[0] }}">Marcar entrada</a>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  {% elif nome %}
    <p class="muted">Nenhum resultado para “{{ nome }}”.</p>
  {% endif %}

{% endblock %}
