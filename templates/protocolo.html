{% extends "base.html" %}
{% block title %}Protocolo{% endblock %}
{% block content %}
<div class="card section">
  <div class="section-title">
    <h2>Protocolo</h2>
    <p class="hint">Pesquise por nome e marque entrada</p>
  </div>

  <form class="form-row" method="GET" action="/protocolo">
    <input class="input" type="text" name="q" placeholder="Ex: Nordine, Joana..." value="{{ q or '' }}">
    <button class="btn" type="submit">Procurar</button>
    <a class="btn btn-ghost" href="/protocolo">Limpar</a>
  </form>

  <div style="margin-top:10px; color:var(--muted); font-size:12px; font-weight:800;">
    Total: {{ total }} | Página {{ page }} de {{ total_pages }}
  </div>

  {% if total_pages > 1 %}
  <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
    {% set start = page - 2 %}
    {% set end = page + 2 %}
    {% if start < 1 %}{% set start = 1 %}{% endif %}
    {% if end > total_pages %}{% set end = total_pages %}{% endif %}

    {% if page > 1 %}
      <a class="pill" href="/protocolo?q={{ q|urlencode }}&page={{ page-1 }}">◀</a>
    {% endif %}

    {% for p in range(start, end+1) %}
      {% if p == page %}
        <span class="pill" style="background:rgba(10,108,214,.16); border-color:rgba(10,108,214,.35); font-weight:1000;">{{ p }}</span>
      {% else %}
        <a class="pill" href="/protocolo?q={{ q|urlencode }}&page={{ p }}">{{ p }}</a>
      {% endif %}
    {% endfor %}

    {% if page < total_pages %}
      <a class="pill" href="/protocolo?q={{ q|urlencode }}&page={{ page+1 }}">▶</a>
    {% endif %}
  </div>
  {% endif %}

  <div class="table">
    <div class="row head">
      <div>ID</div><div>Nome</div><div>Mesa</div><div>Acomp.</div><div>Total</div><div>Status</div><div>Ação</div>
    </div>

    {% for c in convidados %}
    <div class="row">
      <div class="muted">#{{ c.id }}</div>
      <div><b>{{ c.nome }}</b></div>
      <div>{{ c.mesa }}</div>
      <div>{{ c.acompanhantes }}</div>
      <div>{{ 1 + c.acompanhantes }}</div>
      <div>
        {% if c.entrou == "Sim" %}
          <span class="badge badge-ok">Entrou</span>
        {% else %}
          <span class="badge badge-no">Não entrou</span>
        {% endif %}
      </div>
      <div>
        {% if c.entrou == "Sim" %}
          <a class="btn btn-ghost" href="/reset/{{ c.id }}">Resetar</a>
        {% else %}
          <a class="btn btn-success" href="/entrar/{{ c.id }}">Marcar entrada</a>
        {% endif %}
        <a class="btn btn-ghost" href="/qr/{{ c.id }}">Ver QR</a>
      </div>
    </div>
    {% endfor %}

    {% if convidados|length == 0 %}
      <div style="padding:14px; color:var(--muted); font-weight:800;">Nenhum resultado.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
